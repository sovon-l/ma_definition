<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sbe:messageSchema xmlns:sbe="http://fixprotocol.io/2016/sbe"
                   package="proper.gateway.api"
                   id="1"
                   version="1"
                   semanticVersion="1.0"
                   description="for gateway data transfer"
                   byteOrder="littleEndian">
    <types>
        <composite name="messageHeader" description="Message identifiers and length of message root">
            <type name="blockLength" primitiveType="uint16"/>
            <type name="templateId" primitiveType="uint16"/>
            <type name="schemaId" primitiveType="uint16"/>
            <type name="version" primitiveType="uint16"/>
        </composite>
        <composite name="groupSizeEncoding" description="Repeating group dimensions" >
            <type name="blockLength" primitiveType="uint16"/>
            <type name="numInGroup" primitiveType="uint8" semanticType="NumInGroup"/>
        </composite>
        <type name="idString" length="8" primitiveType="char" characterEncoding="ISO_8859_1"/>

        <type name="asset" length="6" primitiveType="char" characterEncoding="US-ASCII"/>
        <enum name="exchange" encodingType="uint8" description="trading exchange">
            <validValue name="binance">0</validValue>
            <validValue name="ftx">1</validValue>
        </enum>
        <enum name="instrumentType" encodingType="uint8" description="instrument type">
            <validValue name="spot">0</validValue>
            <validValue name="future">1</validValue>
            <validValue name="inverse_future">2</validValue>
        </enum>
        <type name="expiry" primitiveType="uint32" presence="optional"/> <!-- intended UNIX ts at s -->
        <composite name="instrument">
            <ref name="exchange" type="exchange"/>
            <ref name="quote" type="asset"/>
            <ref name="base" type="asset"/>
            <ref name="instrumentType" type="instrumentType"/>
            <ref name="expiry" type="expiry"/>
        </composite>
        <composite name="dec">
            <type name="mantissa" primitiveType="int64"/>
            <type name="exponent" primitiveType="int8"/>
        </composite>

        <composite name="acc_id">
            <ref name="exchange" type="exchange"/>
            <ref name="context" type="idString"/>
        </composite>
        <enum name="orderType" encodingType="uint8">
            <validValue name="limit">0</validValue>
            <validValue name="market">1</validValue>
            <validValue name="stop">2</validValue>
        </enum>
        <set name="order_options" encodingType="uint8">
            <choice name="reduce_only">0</choice>
        </set>
        <enum name="time_in_force" encodingType="uint8">
            <validValue name="GoodTill">0</validValue>
            <validValue name="IOC">1</validValue>
            <validValue name="FOK">2</validValue>
        </enum>
        <composite name="simple_order_detail">
            <ref name="orderType" type="orderType"/>
            <ref name="instrument" type="instrument"/>
            <ref name="size" type="dec"/>
            <ref name="order_options" type="order_options"/>

            <!-- limit order only -->
            <ref name="price" type="dec" presence="optional"/>
            <ref name="time_in_force" type="time_in_force" presence="optional"/>
            <type name="expiry_time" primitiveType="uint32" presence="optional"/>

            <!-- stop order only -->
            <ref name="trigger" type="dec" presence="optional"/>
            <ref name="triggered_ordertype" type="orderType" presence="optional"/>
            <!-- stop order triggered ordertype must be limit / mkt, hence reusing above fields -->            
        </composite>
    </types>
    <sbe:message name="placeOrder" id="1">
        <field name="upstream_order_id" id="1" type="idString"/>
        <field name="timestamp" id="2" type="uint32"/>
        <field name="acc_id" id="3" type="acc_id"/>
        <field name="simple_order_detail" id="4" type="simple_order_detail"/>
    </sbe:message>
    <sbe:message name="cancelOrder" id="2">
        <field name="upstream_order_id" id="1" type="idString"/>
    </sbe:message>
</sbe:messageSchema>
