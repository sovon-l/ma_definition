<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sbe:messageSchema xmlns:sbe="http://fixprotocol.io/2016/sbe"
                   package="proper.ma.api"
                   id="1"
                   version="1"
                   semanticVersion="1.0"
                   description="for ma data transfer"
                   byteOrder="littleEndian">
    <types>
        <composite name="messageHeader" description="Message identifiers and length of message root">
            <type name="blockLength" primitiveType="uint16"/>
            <type name="templateId" primitiveType="uint16"/>
            <type name="schemaId" primitiveType="uint16"/>
            <type name="version" primitiveType="uint16"/>
        </composite>
        <composite name="groupSizeEncoding" description="Repeating group dimensions" >
            <type name="blockLength" primitiveType="uint16"/>
            <type name="numInGroup" primitiveType="uint8" semanticType="NumInGroup"/>
        </composite>

        <!-- common -->
        <type name="asset" length="6" primitiveType="char" characterEncoding="US-ASCII"/>
        <enum name="exchange" encodingType="uint8" description="trading exchange">
            <validValue name="binance">0</validValue>
            <validValue name="ftx">1</validValue>
        </enum>
        <composite name="instrument">
            <ref name="exchange" type="exchange"/>
            <ref name="quote" type="asset"/>
            <ref name="base" type="asset"/>
            <enum name="instrumentType" encodingType="uint8" description="instrument type">
                <validValue name="spot">0</validValue>
                <validValue name="future">1</validValue>
                <validValue name="inverse_future">2</validValue>
            </enum>
            <type name="expiry" primitiveType="uint32" presence="optional"/> <!-- intended UNIX ts at s -->
        </composite>
        <composite name="dec">
            <type name="mantissa" primitiveType="int64"/>
            <type name="exponent" primitiveType="int8"/>
        </composite>

        <!-- market -->
        <set name="orderbook_flags" encodingType="uint8">
            <choice name="isSnapshot">0</choice>
            <choice name="L1">1</choice>
        </set>

        <!-- gateway -->
        <type name="idString" length="8" primitiveType="char" characterEncoding="ISO_8859_1"/>
        <composite name="acc_id">
            <ref name="exchange" type="exchange"/>
            <ref name="context" type="idString"/>
        </composite>
        <enum name="orderType" encodingType="uint8">
            <validValue name="limit">0</validValue>
            <validValue name="market">1</validValue>
            <validValue name="stop">2</validValue>
        </enum>
        <composite name="basic_order_detail">
            <ref name="orderType" type="orderType"/>
            <ref name="instrument" type="instrument"/>
            <ref name="price" type="dec" presence="optional"/>
            <ref name="amount" type="dec"/>
            <enum name="time_in_force" encodingType="uint8" presence="optional">
                <validValue name="GoodTill">0</validValue>
                <validValue name="IOC">1</validValue>
                <validValue name="FOK">2</validValue>
            </enum>
            <type name="expiry_time" primitiveType="uint32" presence="optional"/>
            <set name="order_options" encodingType="uint8">
                <choice name="reduce_only">0</choice>
            </set>
        </composite>
        <composite name="simple_order_detail">
            <ref name="orderType" type="orderType"/>
            <ref name="trigger" type="dec" presence="optional"/>
            <ref name="triggered_ordertype" type="basic_order_detail" presence="optional"/>         
        </composite>
    </types>
    <!-- market -->
    <sbe:message name="orderbookMsg" id="1">
        <field name="instrument" id="1" type="instrument"/>
        <field name="market_timestamp" id="2" type="uint64"/>
        <field name="timestamp" id="3" type="uint64" presence="optional"/>
        <field name="orderbook_flags" id="4" type="orderbook_flags"/> <!-- golang need human fix after gen -->
        <group name="depths" id="5" dimensionType="groupSizeEncoding">
            <field name="price" id="1" type="dec"/>
            <field name="size" id="2" type="dec"/>
        </group>
    </sbe:message>
    <sbe:message name="tradeMsg" id="2">
        <field name="instrument" id="1" type="instrument"/>
        <field name="market_timestamp" id="2" type="uint64"/>
        <group name="trades" id="3" dimensionType="groupSizeEncoding">
            <field name="price" id="1" type="dec"/>
            <field name="size" id="2" type="dec"/>
            <field name="timestamp" id="3" type="uint64"/>
            <!-- <field name="tradeId" id="4" type="uint32"/> -->
        </group>
    </sbe:message>

    <!-- gateway -->
    <sbe:message name="placeOrder" id="4">
        <field name="upstream_order_id" id="1" type="idString"/>
        <field name="timestamp" id="2" type="uint32"/>
        <field name="acc_id" id="3" type="acc_id"/>
        <field name="simple_order_detail" id="4" type="simple_order_detail"/>
    </sbe:message>
    <sbe:message name="cancelOrder" id="5">
        <field name="upstream_order_id" id="1" type="idString"/>
    </sbe:message>
</sbe:messageSchema>
