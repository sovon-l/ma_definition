<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<sbe:messageSchema xmlns:sbe="http://fixprotocol.io/2016/sbe"
                   package="proper.ma.api"
                   id="1"
                   version="1"
                   semanticVersion="1.0"
                   description="for ma data transfer"
                   byteOrder="littleEndian">
    <types>
        <composite name="messageHeader" description="Message identifiers and length of message root">
            <type name="blockLength" primitiveType="uint16"/>
            <type name="templateId" primitiveType="uint16"/>
            <type name="schemaId" primitiveType="uint16"/>
            <type name="version" primitiveType="uint16"/>
        </composite>
        <composite name="groupSizeEncoding" description="Repeating group dimensions" >
            <type name="blockLength" primitiveType="uint16"/>
            <type name="numInGroup" primitiveType="uint8" semanticType="NumInGroup"/>
        </composite>

        <!-- common -->
        <type name="asset" length="6" primitiveType="char" characterEncoding="US-ASCII"/>
        <enum name="exchange" encodingType="uint8" description="trading exchange">
            <validValue name="binance">0</validValue>
            <validValue name="ftx">1</validValue>
        </enum>
        <composite name="instrument">
            <ref name="exchange" type="exchange"/>
            <ref name="quote" type="asset"/>
            <ref name="base" type="asset"/>
            <enum name="instrumentType" encodingType="uint8" description="instrument type">
                <validValue name="spot">0</validValue>
                <validValue name="future">1</validValue>
                <validValue name="inverseFuture">2</validValue>
            </enum>
            <type name="expiry" primitiveType="uint32" presence="optional"/> <!-- intended UNIX ts at s -->
        </composite>
        <composite name="dec">
            <type name="mantissa" primitiveType="int64"/>
            <type name="exponent" primitiveType="int8"/>
        </composite>

        <!-- market -->
        <set name="orderbookFlags" encodingType="uint8">
            <choice name="isSnapshot">0</choice>
            <choice name="L1">1</choice>
        </set>

        <!-- gateway -->
        <type name="idString" length="8" primitiveType="char"/>
        <composite name="accId">
            <ref name="exchange" type="exchange"/>
            <ref name="context" type="idString"/>
        </composite>
        <enum name="orderType" encodingType="uint8">
            <validValue name="limit">0</validValue>
            <validValue name="market">1</validValue>
        </enum>
        <composite name="basicOrderDetail">
            <ref name="orderType" type="orderType"/>
            <ref name="instrument" type="instrument"/>
            <ref name="price" type="dec" presence="optional"/>
            <ref name="amount" type="dec"/>
            <enum name="timeInForce" encodingType="uint8" presence="optional">
                <validValue name="GoodTill">0</validValue>
                <validValue name="IOC">1</validValue>
                <validValue name="FOK">2</validValue>
            </enum>
            <type name="expiryTime" primitiveType="uint32" presence="optional"/>
            <set name="orderOptions" encodingType="uint8">
                <choice name="reduceOnly">0</choice>
            </set>
        </composite>
        <composite name="simpleOrderDetail">
            <ref name="execute" type="basicOrderDetail"/>
            <set name="simpleOrderFlag" encodingType="uint8" presence="optional">
                <choice name="isStopLoss">0</choice>
            </set>
            <ref name="trigger" type="dec" presence="optional"/>
        </composite>
        <composite name="orderDetail">
            <ref name="simpleOrderDetail" type="simpleOrderDetail" presence="optional"/>
        </composite>
        <composite name="orderStatus">
            <enum name="orderStatusConcrete" encodingType="uint8">
                <validValue name="Submitting">0</validValue>
                <validValue name="Submitted">1</validValue>
                <validValue name="Cancelling">2</validValue>
                <validValue name="Finished">3</validValue>
            </enum>
            <enum name="errorCode" encodingType="uint8" presence="optional">
                <validValue name="InsufficientFund">0</validValue>
                <validValue name="FailPostOnly">1</validValue>
                <validValue name="Timeout">2</validValue>
                <validValue name="GatewayTooManyRequests">3</validValue>
                <validValue name="ExchangeTooManyRequests">4</validValue>
                <validValue name="ExchangeConnectionError">5</validValue>
                <validValue name="UnexpectedExchangeError">6</validValue>
                <validValue name="UnexpectedGatewayError">7</validValue>
            </enum>
        </composite>
    </types>
    <!-- market -->
    <sbe:message name="quoteMsg" id="1">
        <field name="instrument" id="1" type="instrument"/>
        <field name="marketTimestamp" id="2" type="uint64"/>
        <field name="timestamp" id="3" type="uint64" presence="optional"/>
        <field name="orderbookFlags" id="4" type="orderbookFlags"/> <!-- golang need human fix after gen -->
        <group name="depths" id="5" dimensionType="groupSizeEncoding">
            <field name="price" id="1" type="dec"/>
            <field name="size" id="2" type="dec"/>
        </group>
    </sbe:message>
    <sbe:message name="tradeMsg" id="2">
        <field name="instrument" id="1" type="instrument"/>
        <field name="marketTimestamp" id="2" type="uint64"/>
        <group name="trades" id="3" dimensionType="groupSizeEncoding">
            <field name="price" id="1" type="dec"/>
            <field name="size" id="2" type="dec"/>
            <field name="timestamp" id="3" type="uint64"/>
            <!-- <field name="tradeId" id="4" type="uint32"/> -->
        </group>
    </sbe:message>

    <!-- gateway -->
    <sbe:message name="placeOrderMsg" id="8">
        <field name="upstreamOrderId" id="1" type="idString"/>
        <field name="timestamp" id="2" type="uint32"/>
        <field name="accId" id="3" type="accId"/>
        <field name="orderDetail" id="4" type="orderDetail"/>
    </sbe:message>
    <sbe:message name="cancelOrderMsg" id="9">
        <field name="upstreamOrderId" id="1" type="idString"/>
    </sbe:message>
    <!-- gateway internal -->
    <sbe:message name="orderDetailMsg" id="12">
        <field name="orderDetail" id="1" type="orderDetail"/>
    </sbe:message>
    <sbe:message name="orderStatusMsg" id="13">
        <field name="filledAmount" id="1" type="dec"/>
        <field name="paidAmount" id="2" type="dec"/>
        <field name="commission" id="3" type="dec"/>
        <field name="orderStatus" id="4" type="orderStatus"/>
        <field name="lastUpdate" id="5" type="uint64"/>
        <field name="lastExchangeUpdate" id="6" type="uint64"/>
    </sbe:message>
</sbe:messageSchema>
